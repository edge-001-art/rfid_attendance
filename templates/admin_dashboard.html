<!DOCTYPE html>
<html>
<head>
    <title>Admin Dashboard</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>

<body class="dashboard-container">

<div class="header">
    <h1>ADMIN DASHBOARD</h1>
    <a href="{{ url_for('logout') }}" class="logout-btn">Logout</a>
</div>

<!-- FLASH MESSAGES -->
{% with messages = get_flashed_messages() %}
  {% if messages %}
    <div class="flash">
      {% for message in messages %}
        <p>{{ message }}</p>
      {% endfor %}
    </div>
  {% endif %}
{% endwith %}

<!-- TOTAL -->
<div class="total-box">
    Total Amount: ₱ {{ total }}
</div>

<!-- ================= FILTER ================= -->
<form method="GET" class="filter-form">

    <input type="text" name="search" placeholder="Search Plate"
           value="{{ search }}">

    <select name="rfid_type">
        <option value="All" {% if rfid_type == "All" %}selected{% endif %}>All</option>
        <option value="Autosweep" {% if rfid_type == "Autosweep" %}selected{% endif %}>Autosweep</option>
        <option value="Easytrip" {% if rfid_type == "Easytrip" %}selected{% endif %}>Easytrip</option>
    </select>

    <select name="vehicle_type">
        <option value="All" {% if vehicle_type == "All" %}selected{% endif %}>All Vehicle Types</option>
        <option value="Sedan" {% if vehicle_type == "Sedan" %}selected{% endif %}>Sedan</option>
        <option value="SUV" {% if vehicle_type == "SUV" %}selected{% endif %}>SUV</option>
        <option value="Hatchback" {% if vehicle_type == "Hatchback" %}selected{% endif %}>Hatchback</option>
        <option value="Van" {% if vehicle_type == "Van" %}selected{% endif %}>Van</option>
        <option value="Pickup" {% if vehicle_type == "Pickup" %}selected{% endif %}>Pickup</option>
        <option value="Truck" {% if vehicle_type == "Truck" %}selected{% endif %}>Truck</option>
        <option value="Motorcycle" {% if vehicle_type == "Motorcycle" %}selected{% endif %}>Motorcycle</option>
    </select>

    <button type="submit">Filter</button>
</form>


<!-- ================= PENDING USERS ================= -->
<div class="section">
    <h2>Pending Users</h2>

    <div class="table-container">
        <table>
            <tr>
                <th>Email</th>
                <th>Action</th>
            </tr>

            {% for user in users %}
            <tr>
                <td>{{ user.email }}</td>
                <td>
                    <form method="POST"
                          action="{{ url_for('approve', id=user.id) }}"
                          style="display:inline;">
                        <button type="submit" class="edit-btn">
                            Approve
                        </button>
                    </form>

                    <form method="POST"
                          action="{{ url_for('reject', id=user.id) }}"
                          style="display:inline;">
                        <button type="submit" class="delete-btn">
                            Reject
                        </button>
                    </form>
                </td>
            </tr>
            {% endfor %}
        </table>
    </div>
</div>

<!-- ================= RELOAD BALANCE ================= -->
<div class="section">
    <h2>Reload User Balance</h2>

    <div class="table-container">
        <table>
            <tr>
                <th>Email</th>
                <th>Balance</th>
                <th>Reload</th>
            </tr>

            {% for user in all_users %}
            <tr>
                <td>{{ user.email }}</td>
                <td>₱ {{ "%.2f"|format(user.balance) }}</td>
                <td>
                    <form method="POST"
                          action="{{ url_for('reload_balance', id=user.id) }}">
                        <input type="number" name="amount"
                               placeholder="Amount"
                               step="0.01"
                               required>
                        <button type="submit">Reload</button>
                    </form>
                </td>
            </tr>
            {% endfor %}
        </table>
    </div>
</div>


<!-- ================= ALL TRANSACTIONS ================= -->
<div class="section">
    <h2>All Transactions</h2>

    <div class="table-container">
        <table>
            <tr>
                <th>Date</th>
                <th>Department</th>
                <th>RFID</th>
                <th>Vehicle</th>
                <th>Plate</th>
                <th>Driver</th>
                <th>From</th>
                <th>To</th>
                <th>Location</th>
                <th>Amount</th>
                <th>Remaining</th>
                <th>Action</th>
            </tr>

            {% for log in logs %}
            <tr>
                <td>{{ log.travel_date }}</td>
                <td>{{ log.department }}</td>
                <td>{{ log.rfid_type }}</td>
                <td>{{ log.vehicle_type }}</td>
                <td>{{ log.plate_number }}</td>
                <td>{{ log.driver }}</td>
                <td>{{ log.from_location }}</td>
                <td>{{ log.to_location }}</td>
                <td>{{ log.rfid_location }}</td>
                <td>₱ {{ "%.2f"|format(log.amount) }}</td>
                <td>₱ {{ "%.2f"|format(log.remaining_balance) }}</td>
                <td>
                    <a href="{{ url_for('edit', id=log.id) }}"
                       class="edit-btn">Edit</a>

                    <a href="{{ url_for('delete', id=log.id) }}"
                       class="delete-btn">Delete</a>
                </td>
            </tr>
            {% endfor %}
        </table>
    </div>
</div>

